const ruminationDictionary = {
  "ON FAILURE AND FEELING COOL": {
    1: "There is no reason for student clubs to be so competitive. Like, I’m talking about 10% acceptance rates, multiple interviews, written applications, etc. Why are students my age determining whether or not I get to be a part of their exclusive group? Who are they to decide? Here I am, a 1st year in college, fresh out of the already hellish experience which was college admissions, doing another version of an admissions process—but for student-led clubs. I try hard to get in to a particular club, TAMID, a consulting club, acting as the liaison between start-ups desperate for free labor and students looking for work experience to put on their resume. I go to a months worth of their recruitment events: Hours and hours of listening to people lecture about their clubs, networking, followed by a lengthen written application and then a 20 minute panel interview before I get in my inbox, an email that reads “After careful consideration…” Rejected. I trudge around campus with this rejection weighing heavy on me; My face getting heated whenever I see my interviewers around campus, avoiding eye contact at all costs—but I know they don’t even recognize me.",
    2: "Embarrassment feels so bad. I try my best to avoid any situation that could result in embarrassment. But it’s so easy to find it in life: In class I run the risk of being cold called on, going out wearing a scarf for the first time, or even when I’m walking down a set of stairs—I engage my core and think to myself “god I hope I don’t trip and roll my ankle” (I did that in front of the Snell Library stairs once, and had to sit down among the crowd due to the agonizing pain). Even writing things like this, and posting them for anyone to find, I can’t help but feel embarrassed. It’s weird, invasive, and at the core of it all, I feel so uncomfortable in my own skin. It’s a feeling I can’t purposefully shake off. I wait until I forget about whatever embarrassing instance is gripping me—and every once and awhile, the memory comes flooding back and I cringe. It’s like that mind game where you’re trying to avoid thinking about The Game itself, and every time you remember it, you lose. You just lost by the way.",
    3: "One rejection from a student club was enough for me. They didn’t want me and that was that. Back then, especially being new to college, it was imperative that I felt like I belonged in a space. And I certainly didn’t feel welcome in a community which rejected all my efforts. But I also knew better to put a student-led club on a pedestal. I also genuinely did see how I could fit into the club, and really loved the connections I did make during the recruitment events. I had an inkling on where I fell short in my application, and wanted to put that lesson towards a second time, but boy was I scared; it was a second chance to get rejected and get embarrassed. But there was no one truly important in my life to witness my rejection, and that gave me some relief. I could lick my wounds in private. Publicity, after all, is part of what makes embarrassment so bad, so, I reapplied.",
    4: "My second time around, I got in (I later found out later that I barely got in, but who cares?). TAMID turned out to be one of the most life-changing communities I ever could have joined at Northeastern. Their way of education, care, and due diligence towards building a truly tight-knit community was just the right mixture of chemistry to grow my own confidence in myself. I flourished—doing committees, met some of my best friends, became their VP of Operations and then later, their Executive Vice President. With TAMID behind me, I became more ambitious than I could’ve ever imagined; pursuing research, great internships, and imagining what good I should do with my the fortune in my life.",
    5: "From that experience, I learned that confidence was my currency to handle failure and embarrassment. Before college, I think I was short on confidence change. Not because of anything in particular. It was just the result of being freshly hatched out of a turbulent, adolescence mind, and being unsure of who I really was. I’m thankful college was tender to me. TAMID became a confidence-making machine; people believed in me, I worked hard for them, and together, we achieved some beautiful goals.",
    6: "The height of my confidence-to-failure trading business was the summer of my junior year of school. I was in the midst of healing from a break up and recruiting for software engineering internships. If anyone knows anything about the software engineering recruiting season, it looks something like this: for half a year, you send in about a couple hundreds of applications, spend another hundred of hours on doing LeetCode (technical preparation platform), and hearing back from less than a handful of companies, most of which are companies telling you that they’ve rejected you. Every day, I was spending a little bit of my confidence in hopes for some success. My surplus in confidence was dwindling fast. A particularly bad experience was when I was flown out to San Francisco by Salesforce for the Tech Equality Summit pre-recruitment program to interview for Salesforce’s summer internship program. This program made it so the final interview was really easy and not competitive—everyone flown out was the first people they interviewed for the recruiting season, so everyone had an equal chance of getting in rather than fighting for limited spots on the roster. I thought I had nailed the interview, as did most kids after their interviews because they were relatively straightforward. Two weeks later, the rejection letter hit my mailbox. My heart dropped. There went probably the easiest chance for me to get into “big tech.”",
    7: "By the end of August, I was in the negatives for confidence. I had been applying since May and the failure from Salesforce, coupled with the fact that I didn’t feel quite as emotionally recovered from my break up as I thought I should have been, had taken a huge toll on me. I readied myself for a disappointing recruitment season. Numbing myself from each rejection email, I listlessly applied to random job opportunities, obsessed over LeetCode and refining my resume—and chugged on. This was the mindset I dubbed “robot rachel” (a nod to my finsta handle)—I’ve been given instructions, and I execute them again, and again, regardless of how I feel about result. Yes, I had to give it a corny name like that to be able to impersonate that kind of mindset. It made it feel more like a game, or a part of me which I switched on or off, rather than what defined my whole.",
    8: "Here, I learned how to be numb to failure. Failure was simply just a transition to the next thing—the next application, the next interview, etc. Now, failure costed less confidence than before, so I could handle buying more failures than before. Still, what happens when I hit the bottom of my wallet?",
    9: "Before I could answer that, I was saved with my first offer of the season from The Trade Desk. And I’m not being dramatic when I say “saved.” Getting an offer after months of stressing about recruiting genuinely feels like you’ve been saved. You feel as if you can enjoy life again. Okay, maybe I am being really dramatic. What followed was a reinvigoration to apply, not with the desperation of getting whatever I could get, but to get what I wanted. And that kind of recruiting is always fun. I ended up accepting an offer to go work at LinkedIn over the summer and then following that, Google in the fall.",
    10: "Then, thanks to my restless, anxious mind, I now still feel just as scared as how I started—I don’t want to try any big things in case I lose all my confidence points I’ve gained so far. What if my employers find out I’m not good enough than the rest of their interns? What if I don’t get a return offer? How will I face the recruiting season again? College and internship recruiting are hardly the place where you face the big things in life where failure really matters: I’m looking to apply for graduate school, start a family, figure out how to do a backflip on a snowboard, publish a book, start a commune, etc. As one does. Not to mention maintain things I already have right now; to lose those things I have now would be particularly hurtful because it would feel like I’m going backwards in life, and that certainly would be expensive to my confidence. But, I need to continuously be okay with failure in order to achieve these things. I can’t be afraid of “hitting the bottom of my confidence wallet.” So clearly, my mindset towards failure is all wrong. Failure shouldn’t cost my confidence.",
    11: "This brings me to some foundational questions: What is failure? Is failure real? How should we handle failure? Can you tell I’m a part-philosophy major?",
    12: "I invite you to also think about these questions. Too often, I see people like myself cringe at embarrassment, shy away from the risk of failure, and become demotivated when they do face failure. Is this what we should feel? Is failure just one of those things where people go “well that’s just life”?",
    13: "I think to one of the most famous quotes on how to handle failure: “You miss 100% of the shots you don’t take.” I almost hate this quote, because it misses a pivotal part of failure: You are supposed to reflect and learn from each shot that you missed.",
    14: "Okay, so that’s something closer…whatever failure is, we’re supposed to learn something that brings us closer to what we do want. Well, then this makes failure seem way too good than what it really makes us feel. I’m pretty sure most of us feel bad when we fail at something. So if failure really is this lesson-learning thing that brings us good, then shouldn’t we feel good when we fail at something? Why do we feel bad?",
    15: "There’s a myriad of answers to why we feel bad about failure. Embarrassment. Our ego. If we lost something we care about. If there was external stakes like a family member not being able to get their medicine or something serious of that sort. Clearly, also, we can’t say “don’t feel bad about failure!” because it’s a valid emotion that should happen to some forms of failure. In fact, to look an example a little deeper, take my an example of a desperate guy asking a bunch of girls to get laid—maybe doing even sketchy things like following a girl home, being rude when the girl turns him down, etc. If he felt no sense of shame, embarrassment, or disgust towards his own behavior, then he would likely not perform the necessary introspection to see what he’s doing—causing public disturbance, disrespecting woman and his own integrity. These feelings are important because they can be great indicators that something is wrong. They are guardrails to better the individual in the same way physical pain is for protecting the body.",
    16: "So failure invokes—and should invoke—bad feelings. But the key is not to let those feelings calcify into self-worth—and that’s where I didn’t know about failure before. Before, I thought it was only normal to lose part of my self-worth when I faced failure. The shame or embarrassment I feel from a failure isn’t the truth of who we are; it’s a message. And it’s our job to decipher what it's trying to tell us: Was that failure a sign of misalignment, or simply a rough draft of the person I’m becoming? This is where the growth lies—not in numbing ourselves to failure, nor romanticizing it as inherently noble, but in learning to feel the sting without making it our identity. Embarrassment is temporary, but the lessons we can learn are permanent. Because in the end, failure isn’t about how far we’ve fallen—it’s about what we choose to do once we’ve landed.",
    17: "So here’s my working definition of failure now: it’s not a reflection of who I am, but a process that I can use to shape the good person I want to become. It's a teacher, a threshold, a test of what I care about most. And maybe, if I’m lucky—or just stubborn enough to keep trying—every failure will be less about what I’ve lost, and more about what I’ve just begun to learn.",
  },
};

const ruminationSidenotes = {
  "ON FAILURE AND FEELING COOL": {
    1: "TAMID is a professional-social business club that offers students to get real-world experience in Consulting, Tech Consulting (software), and Investment Fund Management.",
    4: "One committee I did was recruitment. I saw the backend of our selection process, and I saw just how flawed the process is. Because after all, we were just a bunch of college kids.",
    7: "Follow my main @rachelchhen on Instagram",
  },
};

const techProjects = {
  "Social Cues Intervention on Reddit-Like Platform": {
    Links: {
      "Plural Connections Group @ Northeastern":
        "https://www.pluralconnections.org/",
      "Minds, Machine, and Society @ Dartmouth":
        "https://www.cs.dartmouth.edu/~soroush/",
    },
    Purpose: {
      1: "This project was under the Plural Connections Group, where we try to apply and design technologies to advance pluralism. I served as their Research Engineer for a particular project on scaffolding virtues in online spaces, particularly the virtue of intellectual humility in reddit political discourses. Intellectual humility—the recognition of the limits of one’s knowledge and a willingness to engage with opposing viewpoints—is foundational to healthy discourse. In online spaces often marked by polarization and performative certainty, fostering intellectual humility can help cultivate more respectful, open, and constructive conversations. With social media platforms increasingly contributing to misinformation and affective polarization, we asked a simple question: can we introduce better social cues into online conversations to help nudge users to communicate more humbly?",
      2: "By building a simulated Reddit-like environment populated with AI dialogue agents and feedback mechanisms, we tested whether participants would adopt more intellectually humble behaviors if they received nudges mimicking missing in-person social cues. Our broader aim was to contribute to a growing body of research on how digital environments might promote epistemic virtues like humility and empathy in a time of deepening political division.",
    },
    Design: {
      1: "We engineered a custom full-stack web application deployed on AWS that mimics a Reddit-style comment environment to enable controlled experimentation. Built with React on the frontend and Flask on the backend, the platform ran on an EC2 instance and stored data in MongoDB. The application featured seeded discussion threads and allowed participants to post replies, enabling real-time feedback loops based on comment content.",
      2: "project_images/socialcues/ui.png",
      3: "The technical infrastructure supported two primary experimental layers: a Social Cues intervention and an Environment condition. In the Social Cues treatment, we used Perspective API to analyze each unposted comment for three core attributes—respect, curiosity, and nuance. If a comment fell below a threshold on two or more dimensions, the system would pass it to an LLM (via the ChatGPT API) to generate a suggestion for improvement. Participants could revise or submit the original comment.",
      4: "project_images/socialcues/nudge.png",
      5: "To enhance the accuracy of the feedback, we collaborated closely with the Dartmouth NLP Group to develop and fine-tune an intellectual humility classifier specifically trained on political discourse. This involved experimenting with k-shot learning strategies and prompt engineering techniques to align LLM outputs with human judgments on intellectual humility. The Environment treatment used AI dialogue agents—designed to simulate intellectually humble, arrogant, or neutral personas—to reply to participants' comments based on randomized condition assignments.",
      6: "Participants were recruited via Prolific, stratified by political leaning, and asked to engage in two conversations on controversial topics (abortion, immigration, or climate change) that reflected opposing views. Pre- and post-surveys measured shifts in self-reported intellectual humility, and each participant’s behavior was scored based on their posted comments using the classifier pipeline.",
    },
    Reflections: {
      1: "While our study did not find statistically significant average effects of the real-time feedback intervention, the experimental environment yielded compelling insights. Specifically, exposure to intellectually arrogant agents led to decreased humility—both in participants’ behavior and their self-perception. This suggests the atmosphere of online conversations deeply shapes how individuals show up in discourse, independent of their intentions or the feedback they receive.",
      2: "The Social Cues intervention itself may still hold promise, but our results point to the challenge of subtlety: the nudge might have been too light-handed or not sufficiently tailored to participant expectations. We also faced limitations in classifier precision; the Perspective API occasionally misclassified comments in ways that participants may have perceived as incorrect or irrelevant.",
      3: "Going forward, we aim to refine our humility detection models using large language models fine-tuned on human judgments. We’re also preparing to launch a field experiment on Reddit using a new variant of the intervention. More broadly, this work affirms that creating epistemically virtuous online communities cannot rely solely on individual nudges—it must also consider the broader conversational context and social norms embedded in digital spaces.",
    },
  },
  "Truth Agent": {
    Links: {},
    Purpose: {
      1: "@ Google Gemini Developer Competition",
    },
    Design: {},
    Reflections: {},
  },
};

const techProjectsSidenotes = {
  "Social Cues Intervention on Reddit-Like Platform": {
    Purpose: {
      1: "This was my Fall 2024 co-op. I self-sourced it, which means my manager and I met and created the co-op given our shared interests.",
      2: "I was really interested in persuasive design and value sensitive design. Plural Connections Group seemed like the perfect place for me to learn more about it, and get my hands dirty to explore these fields. I also wanted to grow as an engineer.",
    },
    Design: {
      2: "This is the fake Reddit comment section a user would interact with. We would scrape their behavior.",
      3: "Perspective API: https://perspectiveapi.com/",
      4: "This graph is the flow of how our intervention was deployed whenever a user posted a comment that was particularlly intellectually arrogant (opposite to humility).",
      6: "We recruited over 300 candidates. At first, my app failed under the load, and had to deploy load testing using Apache JMeter and AWS Cloud Observability tooling. Learned my lesson to always load test first.",
    },
    Reflections: {
      1: "My supervisor professor said something invaluable: A good research question means that even if there is a null result, that is still a good contribution to science.",
      2: "If you have any suggestions and interest in collaborating, please email me or get in contact with the Plural Connections Group!",
    },
  },
};

function select() {
  document.getElementById("table-view").classList.toggle("not-selected");
  document.getElementById("gallery-view").classList.toggle("selected");
  document.getElementById("table-view").classList.toggle("not-selected");
  document.getElementById("gallery-view").classList.toggle("not-selected");
  document.getElementById("ruminations-view").classList.add("not-selected");

  document.getElementById("table-view-body").classList.toggle("not-selected");
  document.getElementById("gallery-view-body").classList.toggle("selected");
  document.getElementById("table-view-body").classList.toggle("not-selected");
  document.getElementById("gallery-view-body").classList.toggle("not-selected");
  document
    .getElementById("ruminations-view-body")
    .classList.add("not-selected");
}

function selectResume() {
  document.getElementById("gallery-view-body").classList.remove("selected");
  document.getElementById("gallery-view-body").classList.add("not-selected");

  document.getElementById("table-view-body").classList.add("selected");
  document.getElementById("table-view-body").classList.remove("not-selected");

  document.getElementById("technical-view-body").classList.add("not-selected");
  document.getElementById("technical-view-body").classList.remove("selected");

  document
    .getElementById("ruminations-view-body")
    .classList.add("not-selected");
  document.getElementById("ruminations-view-body").classList.remove("selected");
}

function selectMedia() {
  document.getElementById("gallery-view-body").classList.remove("not-selected");
  document.getElementById("gallery-view-body").classList.add("selected");

  document.getElementById("table-view-body").classList.add("not-selected");
  document.getElementById("table-view-body").classList.remove("selected");

  document.getElementById("technical-view-body").classList.add("not-selected");
  document.getElementById("technical-view-body").classList.remove("selected");

  document
    .getElementById("ruminations-view-body")
    .classList.add("not-selected");
  document.getElementById("ruminations-view-body").classList.remove("selected");
}

function selectRuminations() {
  document.getElementById("gallery-view-body").classList.add("not-selected");
  document.getElementById("gallery-view-body").classList.remove("selected");

  document.getElementById("table-view-body").classList.add("not-selected");
  document.getElementById("table-view-body").classList.remove("selected");

  document.getElementById("technical-view-body").classList.add("not-selected");
  document.getElementById("technical-view-body").classList.remove("selected");

  document
    .getElementById("ruminations-view-body")
    .classList.remove("not-selected");
  document.getElementById("ruminations-view-body").classList.add("selected");
}

function selectTechnical() {
  document
    .getElementById("technical-view-body")
    .classList.remove("not-selected");
  document.getElementById("technical-view-body").classList.add("selected");

  document.getElementById("table-view-body").classList.add("not-selected");
  document.getElementById("table-view-body").classList.remove("selected");

  document.getElementById("gallery-view-body").classList.add("not-selected");
  document.getElementById("gallery-view-body").classList.remove("selected");

  document
    .getElementById("ruminations-view-body")
    .classList.add("not-selected");
  document.getElementById("ruminations-view-body").classList.remove("selected");
}

document.querySelectorAll(".menu-item").forEach((item) => {
  item.addEventListener("click", () => {
    document.querySelector(".menu-item.selected")?.classList.remove("selected");
    item.classList.add("selected");
  });
});

function renderContentWithSidenotes(sectionData, sidenotes = {}) {
  return Object.entries(sectionData)
    .map(([index, content]) => {
      const sidenote = sidenotes[index];
      const hasSidenote = sidenote !== undefined;
      const sidenoteHTML = hasSidenote
        ? `<span class="sidenote ${
            index % 2 === 0 ? "left" : "right"
          }">${sidenote}</span>`
        : "";

      if (
        typeof content === "string" &&
        content.match(/\.(jpeg|jpg|png|gif|webp)$/)
      ) {
        return `
          <div class="technical-image-container">
            <img class="technical-image" src="${content}" alt="Project image" />
          </div>`;
      } else {
        return `
          <div class="paragraph-wrapper">
            ${index % 2 === 0 ? sidenoteHTML : ""}
            <p class="rumination-paragraph">${content}</p>
            ${index % 2 !== 0 ? sidenoteHTML : ""}
          </div>`;
      }
    })
    .join("");
}

function setupTechnicalClicks() {
  const reader = document.getElementById("technical-reader");
  const projectLink = document.getElementById("project-link");
  const readerPurposeBody = document.getElementById("reader-purpose-body");
  const readerDesignBody = document.getElementById("reader-design-body");
  const readerReflectionsBody = document.getElementById(
    "reader-reflections-body",
  );

  const backBtn = document.getElementById("back-tech-button");

  document.querySelectorAll(".technical-box").forEach((box) => {
    box.addEventListener("click", () => {
      const title = box.querySelector(".title-role")?.innerText || "Unknown";
      document.getElementById("reader-tech-title").innerText = title;

      const project = techProjects[title];

      if (!project) {
        // fallback
        readerPurposeBody.innerHTML = "<p>Coming soon.</p>";
        readerDesignBody.innerHTML = "<p>Coming soon.</p>";
        readerReflectionsBody.innerHTML = "<p>Coming soon.</p>";
        projectLink.innerHTML = "";
      } else {
        const sidenotes = techProjectsSidenotes[title] || {};

        readerPurposeBody.innerHTML = renderContentWithSidenotes(
          project.Purpose,
          sidenotes.Purpose || {},
        );
        readerDesignBody.innerHTML = renderContentWithSidenotes(
          project.Design,
          sidenotes.Design || {},
        );
        readerReflectionsBody.innerHTML = renderContentWithSidenotes(
          project.Reflections,
          sidenotes.Reflections || {},
        );

        // LINKS
        projectLink.innerHTML = Object.entries(project.Links)
          .map(
            ([linkTitle, url]) =>
              `<a href="${url}" class="invert" target="_blank"><i class="fas fa-link"style="margin-right: 6px;"></i>${linkTitle}</a>`,
          )
          .join("<br/>");
      }

      const reader = document.getElementById("technical-reader");
      reader.style.display = "block";
      void reader.offsetWidth;
      reader.classList.remove("hiding");
      reader.classList.add("showing");
    });
  });

  backBtn.addEventListener("click", () => {
    reader.classList.remove("showing");
    reader.classList.add("hiding");

    // Wait for the animation to finish
    setTimeout(() => {
      reader.classList.remove("hiding");
      reader.style.display = "none";

      // Reset showing class to allow reanimation next time
      void reader.offsetWidth; // Trick to force reflow
    }, 600);
  });
}

document.addEventListener("DOMContentLoaded", () => {
  setupTechnicalClicks();
  const reader = document.getElementById("rumination-reader");
  const backBtn = document.getElementById("back-button");
  const readerTitle = document.getElementById("reader-title");
  const readerBody = document.getElementById("reader-body");

  document.querySelectorAll(".rumination-box").forEach((box) => {
    box.addEventListener("click", async () => {
      const title = box.querySelector(".rumination-title")?.innerText || "";
      const paragraphs = ruminationDictionary[title];
      const sidenotes = ruminationSidenotes[title] || {};

      readerTitle.innerText = title;

      if (!paragraphs) {
        readerBody.innerHTML = `<p class="rumination-paragraph">Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later. Work in progress. Come back later.</p>`;
      } else {
        readerBody.innerHTML = Object.entries(paragraphs)
          .map(([index, text]) => {
            const Sidenote = sidenotes[index];
            const hasSidenote = Sidenote !== undefined;

            const SidenoteHTML = hasSidenote
              ? `<span class="sidenote ${
                  index % 2 === 0 ? "left" : "right"
                }">[${index}] ${Sidenote}</span>`
              : "";

            return `
              <div class="paragraph-wrapper">
                ${index % 2 === 0 ? SidenoteHTML : ""}
                <p class="rumination-paragraph">${text}</p>
                ${index % 2 !== 0 ? SidenoteHTML : ""}
              </div>`;
          })
          .join("");
      }

      // Reset visibility
      reader.style.display = "block";

      // Force reflow to restart animation
      void reader.offsetWidth;

      // Then animate in
      reader.classList.remove("hiding");
      reader.classList.add("showing");
    });
  });

  backBtn.addEventListener("click", () => {
    reader.classList.remove("showing");
    reader.classList.add("hiding");

    // Wait for the animation to finish
    setTimeout(() => {
      reader.classList.remove("hiding");
      reader.style.display = "none";

      // Reset showing class to allow reanimation next time
      void reader.offsetWidth; // Trick to force reflow
    }, 600);
  });
});
